<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExamCoach JAMB - Full Stack Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            color: white;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .container {
            flex: 1;
            padding: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .main-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            padding: 40px;
            max-width: 1000px;
            width: 100%;
            min-height: 600px;
        }

        .subject-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .subject-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border: 2px solid #e0e7ff;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .subject-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .subject-card.english {
            border-color: #2196F3;
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
        }

        .subject-card.math {
            border-color: #4CAF50;
            background: linear-gradient(135deg, #e8f5e8 0%, #c8e6c9 100%);
        }

        .subject-card.physics {
            border-color: #FF5722;
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd9 100%);
        }

        .subject-card.chemistry {
            border-color: #9C27B0;
            background: linear-gradient(135deg, #f3e5f5 0%, #e1bee7 100%);
        }

        .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .hidden {
            display: none !important;
        }

        .quiz-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .question-text {
            font-size: 1.3em;
            line-height: 1.6;
            margin-bottom: 30px;
            color: #333;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .options-container {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            display: flex;
            align-items: center;
        }

        .option:hover {
            border-color: #2196F3;
            background: #f3f8ff;
        }

        .option.selected {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .option.correct {
            border-color: #4CAF50;
            background: #e8f5e8;
        }

        .option.incorrect {
            border-color: #f44336;
            background: #ffebee;
        }

        .option-label {
            font-weight: bold;
            margin-right: 15px;
            min-width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn-primary {
            background: #2196F3;
            color: white;
        }

        .btn-primary:hover {
            background: #1976D2;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #666;
        }

        .error {
            text-align: center;
            padding: 50px;
            color: #f44336;
            font-size: 1.2em;
        }

        .results-container {
            text-align: center;
            padding: 40px;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            color: #2196F3;
            margin: 20px 0;
        }

        .score-breakdown {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .score-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .explanation {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .subject-grid {
                grid-template-columns: 1fr;
            }
            
            .main-content {
                padding: 20px;
                margin: 20px;
            }
            
            .question-header {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üéì ExamCoach JAMB Practice</h1>
        <p>Full-Stack Edition - Practice with Real Database Questions</p>
    </div>

    <div class="container">
        <div class="main-content">
            <!-- Home Screen -->
            <div id="homeScreen">
                <h2 style="text-align: center; margin: 30px 0; color: #333;">Choose Your JAMB Subject</h2>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="text-align: center; color: #2196F3; margin-bottom: 15px;">üéØ Compulsory Subject</h3>
                    <div class="subject-grid" style="max-width: 300px; margin: 0 auto;">
                        <div class="subject-card english" onclick="startQuiz('ENG', 'Use of English')">
                            <div class="icon">üìù</div>
                            <h3>Use of English</h3>
                            <p>Database Questions ‚Ä¢ Timed Practice</p>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="text-align: center; color: #4CAF50; margin-bottom: 15px;">üî¨ Science Subjects</h3>
                    <div class="subject-grid">
                        <div class="subject-card math" onclick="startQuiz('MTH', 'Mathematics')">
                            <div class="icon">üìä</div>
                            <h3>Mathematics</h3>
                            <p>Algebra, Geometry, Calculus</p>
                        </div>
                        <div class="subject-card physics" onclick="startQuiz('PHY', 'Physics')">
                            <div class="icon">‚ö°</div>
                            <h3>Physics</h3>
                            <p>Mechanics, Waves, Electricity</p>
                        </div>
                        <div class="subject-card chemistry" onclick="startQuiz('CHM', 'Chemistry')">
                            <div class="icon">üß™</div>
                            <h3>Chemistry</h3>
                            <p>Organic, Inorganic, Physical</p>
                        </div>
                        <div class="subject-card" style="border-color: #8BC34A;" onclick="startQuiz('BIO', 'Biology')">
                            <div class="icon">üå±</div>
                            <h3>Biology</h3>
                            <p>Cell Biology, Ecology, Genetics</p>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="text-align: center; color: #FF9800; margin-bottom: 15px;">üíº Commercial Subjects</h3>
                    <div class="subject-grid">
                        <div class="subject-card" style="border-color: #FF9800;" onclick="startQuiz('ECO', 'Economics')">
                            <div class="icon">üìà</div>
                            <h3>Economics</h3>
                            <p>Micro, Macro, Development</p>
                        </div>
                        <div class="subject-card" style="border-color: #FF9800;" onclick="startQuiz('ACC', 'Accounting')">
                            <div class="icon">üí∞</div>
                            <h3>Accounting</h3>
                            <p>Financial, Cost, Management</p>
                        </div>
                        <div class="subject-card" style="border-color: #FF9800;" onclick="startQuiz('COM', 'Commerce')">
                            <div class="icon">üè™</div>
                            <h3>Commerce</h3>
                            <p>Trade, Business, Marketing</p>
                        </div>
                    </div>
                </div>

                <div style="margin-bottom: 30px;">
                    <h3 style="text-align: center; color: #9C27B0; margin-bottom: 15px;">üìñ Arts Subjects</h3>
                    <div class="subject-grid">
                        <div class="subject-card" style="border-color: #9C27B0;" onclick="startQuiz('LIT', 'Literature')">
                            <div class="icon">üìö</div>
                            <h3>Literature</h3>
                            <p>African & Non-African Works</p>
                        </div>
                        <div class="subject-card" style="border-color: #9C27B0;" onclick="startQuiz('GOV', 'Government')">
                            <div class="icon">üèõÔ∏è</div>
                            <h3>Government</h3>
                            <p>Political Theory, Nigerian Gov.</p>
                        </div>
                        <div class="subject-card" style="border-color: #9C27B0;" onclick="startQuiz('HIS', 'History')">
                            <div class="icon">üìú</div>
                            <h3>History</h3>
                            <p>Nigerian & African History</p>
                        </div>
                        <div class="subject-card" style="border-color: #9C27B0;" onclick="startQuiz('GEO', 'Geography')">
                            <div class="icon">üåç</div>
                            <h3>Geography</h3>
                            <p>Physical & Human Geography</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Loading Screen -->
            <div id="loadingScreen" class="loading hidden">
                <div>Loading questions from database...</div>
            </div>

            <!-- Error Screen -->
            <div id="errorScreen" class="error hidden">
                <div id="errorMessage">Failed to load questions. Please try again.</div>
                <button class="btn btn-secondary" onclick="goHome()" style="margin-top: 20px;">Back to Home</button>
            </div>

            <!-- Quiz Screen -->
            <div id="quizScreen" class="quiz-container hidden">
                <div class="question-header">
                    <h2 id="subjectTitle">Subject</h2>
                    <div id="questionCounter">Question 1 of 10</div>
                    <div id="timer">Time: 00:00</div>
                </div>

                <div id="questionText" class="question-text">
                    Question will appear here
                </div>

                <div id="optionsContainer" class="options-container">
                    <!-- Options will be populated by JavaScript -->
                </div>

                <div id="explanation" class="explanation hidden">
                    <!-- Explanation will appear here after answering -->
                </div>

                <div class="controls">
                    <button id="prevBtn" class="btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button id="nextBtn" class="btn btn-primary" onclick="nextQuestion()">Next Question</button>
                    <button id="finishBtn" class="btn btn-primary hidden" onclick="finishQuiz()">Finish Quiz</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="resultsScreen" class="results-container hidden">
                <h2>Quiz Complete!</h2>
                <div id="scoreDisplay" class="score-display">85%</div>
                
                <div class="score-breakdown">
                    <div class="score-item">
                        <h3>Correct Answers</h3>
                        <div id="correctCount">8</div>
                    </div>
                    <div class="score-item">
                        <h3>Total Questions</h3>
                        <div id="totalCount">10</div>
                    </div>
                    <div class="score-item">
                        <h3>Average Time</h3>
                        <div id="avgTime">2.3s</div>
                    </div>
                </div>

                <div style="margin-top: 40px;">
                    <button class="btn btn-primary" onclick="goHome()" style="margin-right: 20px;">Try Another Subject</button>
                    <button class="btn btn-secondary" onclick="retakeQuiz()">Retake Quiz</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Configuration
        const API_BASE = 'http://localhost:3000/api';
        
        // Application State
        let currentSession = null;
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let startTime = Date.now();
        let questionStartTime = Date.now();
        let userAnswers = [];
        let subjectCode = '';
        let subjectName = '';

        // Timer functionality
        let timerInterval = null;

        function startTimer() {
            startTime = Date.now();
            timerInterval = setInterval(updateTimer, 1000);
        }

        function updateTimer() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            document.getElementById('timer').textContent = 
                `Time: ${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // API Functions
        async function createSession(subjectCode) {
            try {
                const response = await fetch(`${API_BASE}/sessions/create`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        subjectCode: subjectCode,
                        questionCount: 10
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.success ? data.data : null;
            } catch (error) {
                console.error('Error creating session:', error);
                return null;
            }
        }

        async function loadQuestions(subjectCode) {
            try {
                const response = await fetch(`${API_BASE}/questions/${subjectCode}?limit=10`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.success ? data.data : [];
            } catch (error) {
                console.error('Error loading questions:', error);
                return [];
            }
        }

        async function submitAnswer(questionId, chosenOption, timeSpent) {
            if (!currentSession) return null;
            
            try {
                const response = await fetch(`${API_BASE}/sessions/answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        sessionId: currentSession.sessionId,
                        questionId: questionId,
                        chosenOption: chosenOption,
                        timeSpentMs: timeSpent
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data.success ? data.data : null;
            } catch (error) {
                console.error('Error submitting answer:', error);
                return null;
            }
        }

        // Quiz Functions
        async function startQuiz(code, name) {
            subjectCode = code;
            subjectName = name;
            
            // Show loading screen
            document.getElementById('homeScreen').classList.add('hidden');
            document.getElementById('loadingScreen').classList.remove('hidden');

            try {
                // Load questions and create session
                const [questions, session] = await Promise.all([
                    loadQuestions(code),
                    createSession(code)
                ]);

                if (!questions || questions.length === 0) {
                    throw new Error('No questions available for this subject');
                }

                if (!session) {
                    throw new Error('Failed to create session');
                }

                currentQuestions = questions;
                currentSession = session;
                currentQuestionIndex = 0;
                selectedAnswer = null;
                userAnswers = [];

                // Initialize quiz screen
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('quizScreen').classList.remove('hidden');
                document.getElementById('subjectTitle').textContent = name;
                
                showQuestion();
                startTimer();

            } catch (error) {
                console.error('Error starting quiz:', error);
                document.getElementById('loadingScreen').classList.add('hidden');
                document.getElementById('errorScreen').classList.remove('hidden');
                document.getElementById('errorMessage').textContent = error.message;
            }
        }

        function showQuestion() {
            if (!currentQuestions || currentQuestions.length === 0) return;

            const question = currentQuestions[currentQuestionIndex];
            questionStartTime = Date.now();
            selectedAnswer = null;

            // Update UI
            document.getElementById('questionCounter').textContent = 
                `Question ${currentQuestionIndex + 1} of ${currentQuestions.length}`;
            document.getElementById('questionText').textContent = question.stem;
            document.getElementById('explanation').classList.add('hidden');

            // Create options
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            const options = [
                { label: 'A', text: question.optionA },
                { label: 'B', text: question.optionB },
                { label: 'C', text: question.optionC },
                { label: 'D', text: question.optionD }
            ];

            if (question.optionE) {
                options.push({ label: 'E', text: question.optionE });
            }

            options.forEach(option => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.onclick = () => selectOption(option.label, optionDiv);
                
                optionDiv.innerHTML = `
                    <div class="option-label">${option.label}</div>
                    <div>${option.text}</div>
                `;
                
                optionsContainer.appendChild(optionDiv);
            });

            // Update navigation buttons
            document.getElementById('prevBtn').style.display = currentQuestionIndex === 0 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').style.display = currentQuestionIndex === currentQuestions.length - 1 ? 'none' : 'inline-block';
            document.getElementById('finishBtn').style.display = currentQuestionIndex === currentQuestions.length - 1 ? 'inline-block' : 'none';
        }

        async function selectOption(optionLabel, optionElement) {
            selectedAnswer = optionLabel;
            
            // Update UI
            document.querySelectorAll('.option').forEach(opt => opt.classList.remove('selected'));
            optionElement.classList.add('selected');

            // Calculate time spent
            const timeSpent = Date.now() - questionStartTime;
            
            // Submit answer to backend
            const question = currentQuestions[currentQuestionIndex];
            const result = await submitAnswer(question.id, optionLabel, timeSpent);

            if (result) {
                // Store user answer
                userAnswers[currentQuestionIndex] = {
                    questionId: question.id,
                    chosen: optionLabel,
                    correct: result.correctOption,
                    isCorrect: result.isCorrect,
                    timeSpent: timeSpent,
                    explanation: result.explanation
                };

                // Show immediate feedback
                document.querySelectorAll('.option').forEach(opt => {
                    const label = opt.querySelector('.option-label').textContent;
                    if (label === result.correctOption) {
                        opt.classList.add('correct');
                    } else if (label === optionLabel && !result.isCorrect) {
                        opt.classList.add('incorrect');
                    }
                });

                // Show explanation
                if (result.explanation) {
                    const explanationDiv = document.getElementById('explanation');
                    explanationDiv.innerHTML = `<strong>Explanation:</strong> ${result.explanation}`;
                    explanationDiv.classList.remove('hidden');
                }
            }
        }

        function nextQuestion() {
            if (currentQuestionIndex < currentQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            }
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function finishQuiz() {
            stopTimer();
            showResults();
        }

        function showResults() {
            // Calculate results
            const correctAnswers = userAnswers.filter(answer => answer && answer.isCorrect).length;
            const totalQuestions = currentQuestions.length;
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            const totalTime = userAnswers.reduce((sum, answer) => sum + (answer ? answer.timeSpent : 0), 0);
            const avgTime = Math.round(totalTime / totalQuestions / 1000 * 10) / 10;

            // Update results display
            document.getElementById('scoreDisplay').textContent = `${percentage}%`;
            document.getElementById('correctCount').textContent = correctAnswers;
            document.getElementById('totalCount').textContent = totalQuestions;
            document.getElementById('avgTime').textContent = `${avgTime}s`;

            // Show results screen
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
        }

        function retakeQuiz() {
            startQuiz(subjectCode, subjectName);
        }

        function goHome() {
            stopTimer();
            
            // Reset state
            currentSession = null;
            currentQuestions = [];
            currentQuestionIndex = 0;
            selectedAnswer = null;
            userAnswers = [];

            // Show home screen
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('errorScreen').classList.add('hidden');
            document.getElementById('loadingScreen').classList.add('hidden');
            document.getElementById('homeScreen').classList.remove('hidden');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ExamCoach Full-Stack JAMB App Loaded');
            console.log('Backend API:', API_BASE);
        });
    </script>
</body>
</html>